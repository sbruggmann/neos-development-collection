`3.3.9 (2018-03-21) <https://github.com/neos/neos-development-collection/releases/tag/3.3.9>`_
==============================================================================================

Overview of merged pull requests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

`FEATURE: Add createMissingSitesNode to node:repair <https://github.com/neos/neos-development-collection/pull/1959>`_
---------------------------------------------------------------------------------------------------------------------

When the `/sites` node is missing, Neos can work quite well, but
at least `removeOrphanNodes` will wreck havoc! So this adds a
task to create the sites node if missing.

Note: since `removeOrphanNodes` is in the CR, which has no
notion of what the nodes inside it mean, this check was added
"separately".

* Packages: ``Neos``

`BUGFIX: Fix asset references detection for nodes even more <https://github.com/neos/neos-development-collection/pull/1966>`_
-----------------------------------------------------------------------------------------------------------------------------

Even after #1762 showing asset usage sometimes fails, with an error
that can only be explained by `documentNode` being null when trying
to render a reference.

This change adds another safety net for that case.

`BUGFIX: Only move children with the same dimensionHash in setPath() <https://github.com/neos/neos-development-collection/pull/1697>`_
--------------------------------------------------------------------------------------------------------------------------------------

This changes the code in setPath() to no longer move all children
across all dimension value combinations. Instead only children with
the same dimensionsHash as the currently moved node will be moved
along.

This avoids errors like the one described in #1696.

Fixes #1696

`BUGFIX: Dynamic cache segments not correctly re-evaluated <https://github.com/neos/neos-development-collection/pull/1960>`_
----------------------------------------------------------------------------------------------------------------------------

...
Only a test to expose the wrong behavior at this point.

Fixes: #1958

`TASK: Pass affected entities to flush as array, not one-by-one <https://github.com/neos/neos-development-collection/pull/1949>`_
---------------------------------------------------------------------------------------------------------------------------------

The `NodeDataRepository.persistEntities()` method looped over the
entities and passed them to `flush()` one-by-one. They can be passed
as the array at hand directly.

* Packages: ``ContentRepository``

`TASK: Make sure documentnodeidentifier index is not overlooked <https://github.com/neos/neos-development-collection/pull/1950>`_
---------------------------------------------------------------------------------------------------------------------------------

The `documentnodeidentifier` index defined in `NodeEvent` is not picked
up by Doctrine Migrations when generating a migration. This leads to
it's removal being included in new migrations, and it has actually been
removed unnoticed in the past.

This change adds it to the `Event` class as well, so it is picked up
correctly. See https://github.com/doctrine/doctrine2/issues/6248

* Packages: ``Neos``

`TASK: Change NodeData movedTo from ManyToOne to OneToOne <https://github.com/neos/neos-development-collection/pull/1951>`_
---------------------------------------------------------------------------------------------------------------------------

A node can only be moved to one other node, so ManyToOne was never
correct.

See https://github.com/neos/neos-development-collection/issues/1908

* Packages: ``ContentRepository`` ``Neos``

`BUGFIX: Add null check in getOtherNodeVariants() <https://github.com/neos/neos-development-collection/pull/1897>`_
-------------------------------------------------------------------------------------------------------------------

This avoids a fatal error in case variants of the node are not accessible
for some reason.

Fixes #1896

`TASK: Improvements to the UserInitials view helper <https://github.com/neos/neos-development-collection/pull/1910>`_
---------------------------------------------------------------------------------------------------------------------

Improves the UserInitials view helper a bit by removing the odd dot and the end of "fullFirstName" and trims the result. Additionally strips special characters from "initials".

`Detailed log <https://github.com/neos/neos-development-collection/compare/3.3.8...3.3.9>`_
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
